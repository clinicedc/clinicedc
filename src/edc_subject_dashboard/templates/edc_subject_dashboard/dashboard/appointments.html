
<!-- start appointments -->

<div class="table table-responsive">
	<table class="table table-striped table-hover">
	  <tbody>
        {% for wrapped in appointments %}
            {% if wrapped.visit_schedule_name == visit_schedule.name  %}
                <tr>
					<td><i class="fa fa-calendar-o fa-sm fa-fw"></i> {{wrapped.visit_code}}{% if wrapped.visit_code_sequence %}.{{wrapped.visit_code_sequence}}{% endif %}</td>
					<td>
                        {% if wrapped.appt_status == NEW_APPT %}
                          <i class="fa fa-star-o fa-fw" aria-hidden="true" data-toggle="tooltip" title="New"></i>
                        {% elif wrapped.appt_status == IN_PROGRESS_APPT%}
						  <i class="fa fa-spinner fa-fw" aria-hidden="true" data-toggle="tooltip" title="In progress"></i>
                        {% elif wrapped.appt_status == INCOMPLETE_APPT %}
                          <i class="fa fa-star-half-o fa-fw" aria-hidden="true" data-toggle="tooltip" title="Incomplete"></i>
						{% elif wrapped.appt_status == COMPLETE_APPT %}
                          <i class="fa fa-star fa-fw" aria-hidden="true" data-toggle="tooltip" title="Complete"></i>
						{% endif %}
                        {% if wrapped.appt_status != COMPLETE_APPT %}
						<a role="button" class="btn btn-sm btn-default {% if wrapped.appt_status != IN_PROGRESS_APPT %}disabled{% endif %}"
						    href="{{ wrapped.href }}">
						        <i class="fa fa-pencil fa-fw" aria-hidden="true"></i> Appt
						</a>
                        {% endif %}

                        <!--begin unscheduled appointment -->
                        {% if not wrapped.disabled and wrapped.object.visit_code_sequence == 0 %}
                        	{% if wrapped.appt_status == INCOMPLETE_APPT or wrapped.appt_status == COMPLETE_APPT %}
		                     <a role="button" class="btn btn-sm btn-default" href="{{ wrapped.unscheduled_appointment_url }}">
		                        <i class="fa fa-address-book-o fa-lg" data-toggle="tooltip" title="Add continuation / unscheduled appointment" aria-hidden="true"></i>
		                     </a>
							{% endif %}
						{% endif %}
                        <!--end unscheduled appointment -->


				      {% if wrapped.appt_status == IN_PROGRESS_APPT %}
				        {% with wrapped.wrapped_visit as visit %}
				      	     {% if visit.id %}
				      		
		                        <a role="button" class="btn btn-sm btn-default" href="{{ visit.href }}">
		                            <i class="fa fa-pencil fa-sm" aria-hidden="true"></i> Visit Report
		                        </a>
				      			<a role="button" class="btn btn-sm btn-warning" href="{{ wrapped.forms_url }}">
				      				<i class="fa fa-list-alt fa-sm" aria-hidden="true"></i> Forms
				      			</a>
				      	     {% else %}
					       		<a role="button" class="btn btn-sm btn-warning" href="{{ visit.href }}"
					       		   data-toggle="tooltip" title="Click to update the visit report">
					       			<i class="fa fa-plus fa-sm" aria-hidden="true"></i> Start</a>
				      	     {% endif %}
				      {% endwith %}
				      {% else %}
						    {% comment%}
						        This link goes to change the appointment instance
						        for user to set appt_status == IN_PROGESS_APPT.
						    {% endcomment%}
						    {% if not wrapped.disabled %}
							    <a role="button" 
							        data-toggle="tooltip" title="Start, continue or restart data collection for this timepoint."
							            class="btn btn-sm btn-default" href="{{ wrapped.href }}">
                                     {% if wrapped.appt_status == NEW_APPT %}
                                       Start
                                    {% elif wrapped.appt_status == IN_PROGRESS_APPT%}
                                       Continue
                                    {% elif wrapped.appt_status == INCOMPLETE_APPT %}
                                       Continue
                                    {% elif wrapped.appt_status == COMPLETE_APPT %}
                                       <i class="fa fa-check fa-fw"></i>Done
                                    {% endif %}
							    </a>
							{% else %}
                                <a role="button" data-toggle="tooltip" title="Disabled while another appointment is in progress." 
                                    class="btn btn-sm btn-default" href="#">
                                     {% if wrapped.appt_status == NEW_APPT %}
                                       Start
			                        {% elif wrapped.appt_status == IN_PROGRESS_APPT%}
                                       Continue
			                        {% elif wrapped.appt_status == INCOMPLETE_APPT %}
                                       Continue
			                        {% elif wrapped.appt_status == COMPLETE_APPT %}
                                       <i class="fa fa-check fa-fw"></i>Done
			                        {% endif %}
                                </a>
							{% endif %}
				      {% endif %}
                      {% if wrapped.appt_status == COMPLETE_APPT %}
                                <a role="button" class="btn btn-sm btn-default" href="{{ wrapped.wrapped_visit.href }}">
                                    <i class="fa fa-pencil fa-sm" aria-hidden="true"></i> Review
                                </a>
                      {% endif %}
				      
	   		        </td>
	   		        <td>{{wrapped.object.title}}</td>
                    <td>{{ wrapped.object.appt_datetime|date:"SHORT_DATE_FORMAT" }} {{ wrapped.object.appt_datetime|date:"D"| capfirst }}</td>
                </tr>
		  {% endif %}
        {% endfor %}
		</tbody>
	 </table>
 </div>

<!-- end appointments -->
