{% load edc_base_extras %}
{% load tz %}
<div class="panel-group">
	<div class="panel panel-success">
		<div class="panel-heading clearfix"><i class="fa fa-flask fa-fw" aria-hidden="true"></i> Requisitions
		<label class="small pull-right" title="visit report datetime">{{ appointment.object.visit.report_datetime|localtime|date:"SHORT_DATETIME_FORMAT" }}</label>
		</div>
 		<div class="table table-responsive">
			<table class="table table-striped table-hover">
				<tbody>

					{% for requisition in requisitions %}
				    	<tr>
				    		<td><span class="text text-muted {% if requisition.entry_status == NOT_REQUIRED %}small{% endif %}">{{ forloop.counter }}</span></td>
				    		<td>
	                            {% if requisition.entry_status == NOT_REQUIRED %}
	                                <span class="text text-muted small">
	                                 {{ requisition.panel_name }}
	                                </span>
                                {% else %}
                                    {{ requisition.panel_name }}
                                    {% if requisition.object.user_created %}
                                        <p class="text small text-default">
                                            {{ requisition.object.user_created }} on {{ requisition.object.object.created|date:"SHORT_DATETIME_FORMAT" }}
                                            {% if requisition.object.user_modified %} | {{ requisition.object.user_modified }} on {{ requisition.object.object.modified|date:"SHORT_DATETIME_FORMAT" }}{% endif %}
                                        </p>
                                    {% endif %}
                                {% endif %}
				    		</td>
						    <td>
				    			{% if requisition.object.is_drawn == YES and requisition.object.requisition_identifier %}
				    				<span class="btn btn-sm btn-default">{{ requisition.object.requisition_identifier|human }}</span>
				    			{% elif requisition.object.is_drawn == NO %}
				    			    <span class="btn btn-sm btn-danger">NOT DRAWN</span>
				    			{% endif %}

								<span class="btn-group pull-right">
	                            {% if requisition.entry_status != NOT_REQUIRED %}
	    							<a role="button" class="btn btn-sm {% if requisition.object.id %}btn-success{% else %}{% if requisition.entry_status == NOT_REQUIRED %} disabled btn-default{% else %}btn-warning{% endif %}{% endif %}" 
											href="{{ requisition.object.href }}">
											{% if requisition.object.id %}
												<span class="fa fa-pencil fa-fw"></span> Edit
											{% else %}
												<span class="fa fa-plus fa-fw"></span> Add
											{% endif %}
		       						</a> 
				     		        <a role="button" class="btn btn-sm btn-default" 
							        	{% if requisition.entry_status == NOT_REQUIRED or not requisition.object %} disabled {% endif %} 
							        		href="{{ requisition.object.get_absolute_url }}?edc_readonly=1&edc_readonly_{{ requisition.object.next_url }}&&{{ requisition.object.querystring }}">View</a>
					    	        <a href="#" role="button" class="btn btn-sm btn-default">Audit</a>
	                              {% else%}
	                                <span class="text text-muted small">not required</span>
	                              {% endif %}
						       	</span>
						    </td>
				    	</tr>
				    {% endfor %}
	
                    {% if not requisitions %}
                        <tr>
                            <td colspan="4">
                            <span class="text text-muted small">
                                  There are no required requisitions for this visit.
                            </span>
                            </td>
                        </tr>
                    {% endif %}
				    {% if appointment.object.visit.visit.requisitions_prn %}
				    	<tr><td colspan="4">
						<span class="text text small pull-right">
				    	PRN Requisitions are available.
				    	</span>
				    	</td></tr>
				    {% endif %}



				</tbody>
			</table>
		</div>
	</div>
</div>