from django.conf import settings
from django.db import models
from django.utils.translation import ugettext_lazy as _

from edc_consent.models.validators import eligible_if_no, FullNameValidator
from edc_consent.encrypted_fields import LastnameField
from edc_constants.choices import YES_NO


class VulnerabilityFieldsMixin(models.Model):

    is_incarcerated = models.CharField(
        verbose_name="Is the participant under involuntary incarceration?",
        max_length=3,
        choices=YES_NO,
        validators=[eligible_if_no, ],
        default='-',
        null=True,
        help_text="( if 'Yes' STOP patient cannot be consented )",
    )

    is_literate = models.CharField(
        verbose_name="Is the participant LITERATE?",
        max_length=3,
        choices=YES_NO,
        default=None,
        help_text="( if 'No' provide witness\'s name on this form and signature on the paper document.)",
    )

    witness_name = LastnameField(
        verbose_name="Witness\'s Last and first name (illiterates only)",
        validators=[FullNameValidator()],
        blank=True,
        null=True,
        help_text=_(
            'Required only if subject is illiterate. Format is \'LASTNAME, FIRSTNAME\'. '
            'All uppercase separated by a comma.'),
    )

    language = models.CharField(
        verbose_name='Language of edc_consent',
        max_length=25,
        choices=settings.LANGUAGES,
        default='not specified',
        help_text='The language used for the edc_consent process will also be used during data collection.'
    )

    class Meta:
        abstract = True
